<!DOCTYPE html>
<html>
<head>
    <title>Firebase ì±„íŒ… ë°ì´í„° ì‚­ì œ</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Firebase ì±„íŒ… ë°ì´í„° ì‚­ì œ ë„êµ¬</h1>
    
    <button onclick="clearAllChatData()" style="background: red; color: white; padding: 10px 20px; margin: 10px;">
        âš ï¸ ëª¨ë“  ì±„íŒ… ë°ì´í„° ì‚­ì œ
    </button>
    
    <button onclick="listAllChatRooms()" style="background: blue; color: white; padding: 10px 20px; margin: 10px;">
        ğŸ“‹ ì±„íŒ…ë°© ëª©ë¡ ë³´ê¸°
    </button>
    
    <div id="status" style="margin-top: 20px; padding: 20px; border: 1px solid #ccc;"></div>
    
    <script>
        // Firebase ì„¤ì • (firebase-config.jsì™€ ë™ì¼)
        const firebaseConfig = {
            apiKey: "AIzaSyC-Bg-4gJmAE0EFSR1ggdMDKLFGz1v3Qm0",
            authDomain: "uniboook.firebaseapp.com",
            projectId: "uniboook",
            storageBucket: "uniboook.firebasestorage.app",
            messagingSenderId: "425119774030",
            appId: "1:425119774030:web:76f7b6bd7b8bb36d717693"
        };
        
        // Firebase ì´ˆê¸°í™”
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const db = firebase.firestore();
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
            console.log(message);
        }
        
        // ëª¨ë“  ì±„íŒ… ë°ì´í„° ì‚­ì œ
        async function clearAllChatData() {
            if (!confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ì±„íŒ… ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }
            
            updateStatus('ğŸ—‘ï¸ ì±„íŒ… ë°ì´í„° ì‚­ì œ ì‹œì‘...');
            
            try {
                // 1. ëª¨ë“  ì±„íŒ…ë°© ì¡°íšŒ
                const chatroomsSnapshot = await db.collection('chatrooms').get();
                updateStatus(`ğŸ“‚ ë°œê²¬ëœ ì±„íŒ…ë°©: ${chatroomsSnapshot.size}ê°œ`);
                
                let deletedMessages = 0;
                let deletedChatrooms = 0;
                
                // 2. ê° ì±„íŒ…ë°©ì˜ ë©”ì‹œì§€ë“¤ ì‚­ì œ
                for (const chatroomDoc of chatroomsSnapshot.docs) {
                    const chatroomId = chatroomDoc.id;
                    updateStatus(`ğŸ” ì±„íŒ…ë°© ${chatroomId}ì˜ ë©”ì‹œì§€ ì‚­ì œ ì¤‘...`);
                    
                    // í•´ë‹¹ ì±„íŒ…ë°©ì˜ ëª¨ë“  ë©”ì‹œì§€ ì¡°íšŒ ë° ì‚­ì œ
                    const messagesSnapshot = await db.collection('chatrooms').doc(chatroomId).collection('messages').get();
                    
                    if (messagesSnapshot.size > 0) {
                        updateStatus(`ğŸ“¨ ì±„íŒ…ë°© ${chatroomId}ì—ì„œ ${messagesSnapshot.size}ê°œ ë©”ì‹œì§€ ë°œê²¬`);
                        
                        // ë°°ì¹˜ ì‚­ì œ
                        const batch = db.batch();
                        messagesSnapshot.docs.forEach(messageDoc => {
                            batch.delete(messageDoc.ref);
                        });
                        
                        await batch.commit();
                        deletedMessages += messagesSnapshot.size;
                        updateStatus(`âœ… ì±„íŒ…ë°© ${chatroomId}ì˜ ${messagesSnapshot.size}ê°œ ë©”ì‹œì§€ ì‚­ì œ ì™„ë£Œ`);
                    }
                    
                    // ì±„íŒ…ë°© ë¬¸ì„œ ì‚­ì œ
                    await chatroomDoc.ref.delete();
                    deletedChatrooms++;
                    updateStatus(`ğŸ—‘ï¸ ì±„íŒ…ë°© ${chatroomId} ì‚­ì œ ì™„ë£Œ`);
                }
                
                updateStatus(`ğŸ‰ ì‚­ì œ ì™„ë£Œ! ì±„íŒ…ë°©: ${deletedChatrooms}ê°œ, ë©”ì‹œì§€: ${deletedMessages}ê°œ`);
                updateStatus('ğŸ’¡ ì´ì œ MySQLì˜ chat_room í…Œì´ë¸”ë„ ìˆ˜ë™ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”.');
                
            } catch (error) {
                updateStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ
        async function listAllChatRooms() {
            updateStatus('ğŸ“‹ ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì¤‘...');
            
            try {
                const chatroomsSnapshot = await db.collection('chatrooms').get();
                updateStatus(`ğŸ“‚ ì´ ${chatroomsSnapshot.size}ê°œ ì±„íŒ…ë°© ë°œê²¬`);
                
                for (const chatroomDoc of chatroomsSnapshot.docs) {
                    const chatroomId = chatroomDoc.id;
                    const messagesSnapshot = await db.collection('chatrooms').doc(chatroomId).collection('messages').get();
                    
                    updateStatus(`ğŸ“ ì±„íŒ…ë°© ID: ${chatroomId} (ë©”ì‹œì§€ ${messagesSnapshot.size}ê°œ)`);
                }
                
            } catch (error) {
                updateStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error('ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í‘œì‹œ
        updateStatus('ğŸš€ Firebase ì±„íŒ… ë°ì´í„° ì‚­ì œ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
        updateStatus('âš ï¸ ì´ ë„êµ¬ëŠ” Firebase Firestoreì˜ ëª¨ë“  ì±„íŒ… ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤');
        updateStatus('ğŸ’¡ ì‚­ì œ í›„ì—ëŠ” MySQLì˜ chat_room í…Œì´ë¸”ë„ ìˆ˜ë™ìœ¼ë¡œ ì •ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤');
    </script>
</body>
</html>