<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${post.title + ' - Unibook'}">게시글 상세 - Unibook</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- GLightbox CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
    
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
    <!-- Status Badge CSS -->
    <link th:href="@{/css/status-badge.css}" rel="stylesheet">
    
    <!-- 공통 스타일 (알림 등) -->
    <div th:replace="~{fragments/header :: styles}"></div>
    
    <!-- CSRF Token -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    
    <!-- 사용자 정보 메타 태그 -->
    <div th:replace="~{fragments/header :: user-meta}"></div>
    
    <style>
        /* CSS 변수 정의 */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --card-hover-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            --border-radius: 16px;
        }
        
        /* 히어로 섹션 - 게시글 목록과 동일 */
        .hero-section {
            background: var(--primary-gradient);
            color: white;
            padding: 60px 0 120px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23fff' fill-opacity='0.05'%3E%3Ccircle cx='50' cy='50' r='40'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 200px 200px;
        }
        
        .hero-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .breadcrumb-nav {
            background: transparent;
            padding: 0;
            margin-bottom: 15px;
        }
        
        .breadcrumb-nav .breadcrumb-item {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .breadcrumb-nav .breadcrumb-item.active {
            color: white;
        }
        
        .breadcrumb-nav .breadcrumb-item + .breadcrumb-item::before {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .breadcrumb-nav a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb-nav a:hover {
            color: white;
        }
        
        /* 메인 콘텐츠 카드 */
        .main-content-card {
            background: white;
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-top: -80px;
            position: relative;
            z-index: 10;
            overflow: hidden;
        }
        
        /* BreadCrumb 스타일 */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            color: #6c757d;
        }
        
        .breadcrumb-item a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: #5a6fd8;
            text-decoration: underline;
        }
        
        .breadcrumb-item.active {
            color: #6c757d;
        }
        
        /* 이미지 갤러리 - 단순한 캐러셀 */
        .image-gallery {
            background: #f8f9fa;
            border-radius: 20px 20px 0 0;
            overflow: hidden;
        }
        
        .main-image-wrapper {
            position: relative;
            width: 100%;
            height: 480px;
            background: #f8f9fa;
            overflow: hidden;
        }
        
        .gallery-image {
            cursor: zoom-in;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* 썸네일 갤러리 - 고정 높이 */
        .thumbnail-gallery {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: white;
            overflow-x: auto;
            scrollbar-width: thin;
            min-height: 110px;
            align-items: center;
            justify-content: center;
        }
        
        .thumbnail-item {
            flex: 0 0 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            background: #f8f9fa;
        }
        
        .thumbnail-item.active {
            border-color: #667eea;
        }
        
        .thumbnail-item:hover {
            transform: scale(1.05);
        }
        
        .thumbnail-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* 콘텐츠 섹션 */
        .content-section {
            padding: 40px;
        }
        
        /* 제목 스타일 */
        .post-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #212529;
            margin: 15px 0 20px 0;
            line-height: 1.3;
        }
        
        /* 메타 정보 */
        .post-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .post-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Status badge styles moved to status-badge.css */
        /* Override position for detail page */
        .content-section .status-badge {
            position: static;
            display: inline-flex;
            margin-bottom: 15px;
        }
        
        /* 가격 표시 */
        .price-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin: 20px 0;
        }
        
        /* 정보 카드 */
        .info-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .info-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        
        .info-card h6 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-card h6 i {
            color: #667eea;
        }
        
        /* 판매자 카드 개선 */
        .seller-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .seller-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }
        
        .seller-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        /* 액션 버튼 개선 */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }
        
        .action-buttons .d-flex {
            width: 100%;
        }
        
        .action-buttons .w-100 {
            display: flex;
            gap: 12px;
            width: 100%;
        }
        
        /* 비작성자 버튼 스타일 */
        .action-buttons .w-100 .btn-chat {
            flex: 1;
        }
        
        .action-buttons .w-100 .btn-wishlist {
            flex: 1;
        }
        
        /* 로그인하여 문의하기 버튼 */
        .action-buttons .btn-chat.w-100 {
            width: 100% !important;
        }
        
        @media (min-width: 992px) {
            .action-buttons {
                flex-direction: column;
                gap: 12px;
            }
        }
        
        .btn-chat {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-chat:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        .btn-wishlist {
            background: white;
            color: #dc3545;
            border: 2px solid #dc3545;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            min-width: 150px;
            flex: 1;
        }
        
        @media (min-width: 992px) {
            .btn-wishlist {
                min-width: auto;
                flex: none;
            }
        }
        
        .btn-wishlist:hover {
            background: #dc3545;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }
        
        .btn-wishlist.active {
            background: #dc3545;
            color: white;
        }
        
        /* 수정 버튼 스타일 */
        .btn-edit {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-edit:hover {
            background: #e9ecef;
            color: #495057;
            border-color: #adb5bd;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(173, 181, 189, 0.3);
        }
        
        /* 삭제 버튼 스타일 (찜하기와 동일) */
        .btn-delete {
            background: white;
            color: #dc3545;
            border: 2px solid #dc3545;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-delete:hover {
            background: #dc3545;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }
        
        /* 상태 변경 버튼 스타일 */
        .btn-status {
            background: white;
            color: #6c757d;
            border: 2px solid #6c757d;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-status:hover {
            background: #6c757d;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
        }
        
        /* 드롭다운 화살표 위치 조정 */
        .btn-status.dropdown-toggle::after {
            margin-left: 8px;
            vertical-align: middle;
        }
        
        /* 거래 방법 태그 */
        .transaction-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .transaction-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #6c757d;
            font-weight: normal;
        }
        
        /* 과목 타입 배지 스타일 개선 */
        .subject-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.75rem;
            color: #6c757d;
            font-weight: normal;
            margin-left: 8px;
        }
        
        /* 설명 섹션 */
        .description-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }
        
        .description-section h5 {
            color: #212529;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .description-content {
            color: #495057;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        /* 관련 게시글 캐러셀 */
        .related-section {
            padding: 60px 0;
            background: #f8f9fa;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #212529;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .swiper-navigation {
            display: flex;
            gap: 10px;
        }
        
        .swiper-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid #dee2e6;
            color: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .swiper-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .swiper-btn.swiper-button-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* 관련 게시글 카드 */
        .related-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            height: 100%;
            cursor: pointer;
        }
        
        .related-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-hover-shadow);
        }
        
        .related-card-image {
            height: 200px;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }
        
        .related-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .related-card:hover .related-card-image img {
            transform: scale(1.05);
        }
        
        .related-card-body {
            padding: 20px;
        }
        
        .related-card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .related-card-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }
        
        /* 메타 정보 스타일 (list.html과 동일) */
        .related-card .meta-info {
            flex: 1;
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .related-card .meta-info i {
            margin-right: 3px;
            font-size: 0.8rem;
        }
        
        .related-card .post-subject-name,
        .related-card .post-professor-name,
        .related-card .post-book-title {
            color: #495057;
        }
        
        /* 하단 정보 스타일 */
        .related-card .card-footer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }
        
        .related-card .wishlist-count {
            font-weight: 500;
        }
        
        /* 애니메이션 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        /* Desktop 2컬럼 레이아웃 - 상세 설명을 왼쪽 하단에 */
        @media (min-width: 992px) {
            .description-section {
                margin-top: 30px;
                margin-left: 20px;
                margin-right: 0;
                border-radius: 12px;
            }
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .hero-section {
                padding: 30px 0 50px;
            }
            
            .main-content-card {
                margin-top: -30px;
                border-radius: 16px;
            }
            
            .content-section {
                padding: 20px;
            }
            
            .main-image-wrapper {
                height: 350px;
            }
            
            .post-title {
                font-size: 1.5rem;
            }
            
            .post-meta {
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .price-display {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-wishlist {
                width: 100%;
            }
            
            .thumbnail-gallery {
                padding: 15px;
                gap: 8px;
            }
            
            .thumbnail-item {
                flex: 0 0 60px;
                height: 60px;
            }
        }
        
        /* 다크모드 스타일 */
        [data-bs-theme="dark"] .main-content-card {
            background: var(--bs-dark);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        [data-bs-theme="dark"] .image-gallery {
            background: var(--bs-gray-800);
        }
        
        [data-bs-theme="dark"] .main-image-wrapper {
            background: var(--bs-gray-800);
        }
        
        [data-bs-theme="dark"] .thumbnail-gallery {
            background: var(--bs-dark);
        }
        
        [data-bs-theme="dark"] .post-title {
            color: var(--bs-gray-100);
        }
        
        [data-bs-theme="dark"] .post-meta {
            color: var(--bs-gray-400);
        }
        
        [data-bs-theme="dark"] .info-card {
            background: var(--bs-gray-800);
            border-color: var(--bs-gray-700);
        }
        
        [data-bs-theme="dark"] .info-card:hover {
            border-color: #8b9bff;
        }
        
        [data-bs-theme="dark"] .info-card h6 {
            color: var(--bs-gray-200);
        }
        
        [data-bs-theme="dark"] .transaction-tag {
            background: var(--bs-gray-700);
            border-color: var(--bs-gray-600);
            color: var(--bs-gray-300);
        }
        
        [data-bs-theme="dark"] .subject-type-badge {
            background: var(--bs-gray-700);
            border-color: var(--bs-gray-600);
            color: var(--bs-gray-300);
        }
        
        [data-bs-theme="dark"] .description-section {
            background: var(--bs-gray-800);
            border-color: var(--bs-gray-700);
        }
        
        [data-bs-theme="dark"] .description-section h5 {
            color: var(--bs-gray-100);
        }
        
        [data-bs-theme="dark"] .description-content {
            color: var(--bs-gray-300);
        }
        
        [data-bs-theme="dark"] .related-section {
            background: var(--bs-gray-900);
        }
        
        [data-bs-theme="dark"] .section-title {
            color: var(--bs-gray-100);
        }
        
        [data-bs-theme="dark"] .related-card {
            background: var(--bs-dark);
        }
        
        [data-bs-theme="dark"] .related-card .meta-info {
            color: var(--bs-gray-400);
        }
        
        [data-bs-theme="dark"] .related-card .post-subject-name,
        [data-bs-theme="dark"] .related-card .post-professor-name,
        [data-bs-theme="dark"] .related-card .post-book-title {
            color: var(--bs-gray-300);
        }
        
        [data-bs-theme="dark"] .related-card .card-footer-info {
            border-top-color: var(--bs-gray-700);
        }
        
        [data-bs-theme="dark"] .swiper-btn {
            background: var(--bs-gray-800);
            border-color: var(--bs-gray-700);
            color: var(--bs-gray-300);
        }
        
        [data-bs-theme="dark"] .swiper-btn:hover {
            background: #8b9bff;
            border-color: #8b9bff;
            color: white;
        }
        
        [data-bs-theme="dark"] .btn-wishlist {
            background: var(--bs-dark);
            border-color: #dc3545;
        }
        
        [data-bs-theme="dark"] .breadcrumb-item a {
            color: #8b9bff;
        }
        
        [data-bs-theme="dark"] .breadcrumb-item a:hover {
            color: #a3b3ff;
        }
        
        [data-bs-theme="dark"] .breadcrumb-item.active {
            color: var(--bs-gray-400);
        }
    </style>
</head>
<body>
<!-- 공통 헤더 포함 -->
<nav th:replace="~{fragments/header :: header}"></nav>

<!-- 히어로 섹션 - 게시글 목록과 동일 -->
<section class="hero-section">
    <div class="container position-relative">
        <h1 class="mb-3">상품 상세보기</h1>
        <p class="lead mb-0">관심있는 상품의 자세한 정보를 확인하고 거래해보세요</p>
    </div>
</section>

<!-- 메인 콘텐츠 -->
<div class="container">
    <div class="main-content-card fade-in-up">
        <div class="row g-0">
            <!-- 이미지 갤러리 섹션 -->
            <div class="col-lg-6">
                <div class="image-gallery">
                    <!-- 메인 이미지 영역 -->
                    <div class="main-image-wrapper">
                        <!-- 이미지가 있을 때 -->
                        <div th:if="${post.postImages != null and !post.postImages.isEmpty()}" class="w-100 h-100">
                            <div id="imageCarousel" class="carousel slide h-100" data-bs-ride="false">
                                <div class="carousel-inner h-100">
                                    <div th:each="image, iterStat : ${post.postImages}" 
                                         th:class="'carousel-item h-100' + ${iterStat.index == 0 ? ' active' : ''}">
                                        <div class="d-flex align-items-center justify-content-center h-100 p-3">
                                            <img th:src="${image.imageUrl}" 
                                                 th:alt="'상품 이미지 ' + ${iterStat.index + 1}"
                                                 class="gallery-image"
                                                 style="max-width: 100%; max-height: 100%; object-fit: contain;"
                                                 th:data-gallery="gallery1">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 캐러셀 컨트롤 (이미지가 2개 이상일 때만 표시) -->
                                <div th:if="${#lists.size(post.postImages) > 1}">
                                    <button class="carousel-control-prev" type="button" 
                                            data-bs-target="#imageCarousel" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" 
                                            data-bs-target="#imageCarousel" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 이미지가 없을 때 -->
                        <div th:unless="${post.postImages != null and !post.postImages.isEmpty()}" 
                             class="d-flex align-items-center justify-content-center w-100 h-100">
                            <div class="text-center text-muted">
                                <i class="bi bi-image" style="font-size: 5rem;"></i>
                                <p class="mt-3 mb-0">이미지가 없습니다</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 썸네일 갤러리 (이미지가 2개 이상일 때만 표시) -->
                    <div th:if="${post.postImages != null and !post.postImages.isEmpty() and #lists.size(post.postImages) > 1}" 
                         class="thumbnail-gallery">
                        <div th:each="image, iterStat : ${post.postImages}" 
                             class="thumbnail-item"
                             th:classappend="${iterStat.index == 0 ? ' active' : ''}"
                             data-bs-target="#imageCarousel"
                             th:data-bs-slide-to="${iterStat.index}">
                            <img th:src="${image.imageUrl}" 
                                 th:alt="'썸네일 ' + ${iterStat.index + 1}">
                        </div>
                    </div>
                </div>
                
                <!-- Desktop에서 상세 설명을 왼쪽 하단에 배치 -->
                <div th:if="${post.description}" class="description-section d-none d-lg-block">
                    <h5><i class="bi bi-card-text"></i> 상세 설명</h5>
                    <div class="description-content" th:text="${post.description}">설명</div>
                </div>
            </div>
            
            <!-- 정보 섹션 -->
            <div class="col-lg-6">
                <div class="content-section">
                    <!-- BreadCrumb -->
                    <nav aria-label="breadcrumb" class="mb-3">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <a href="/" class="text-decoration-none">
                                    <i class="bi bi-house-fill"></i> 홈
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">
                                <span th:switch="${post.productType.toString()}">
                                    <span th:case="'TEXTBOOK'">전공교재</span>
                                    <span th:case="'CERTBOOK'">자격증 교재</span>
                                    <span th:case="'NOTE'">필기노트</span>
                                    <span th:case="'PASTEXAM'">족보/기출</span>
                                    <span th:case="*">기타</span>
                                </span>
                            </li>
                        </ol>
                    </nav>
                    
                    <!-- 상태 표시 -->
                    <div class="mb-3">
                        <span th:switch="${post.status}" class="status-badge"
                              th:classappend="${post.status.toString() == 'AVAILABLE' ? 'available' : 
                                              (post.status.toString() == 'RESERVED' ? 'reserved' : 
                                              (post.status.toString() == 'BLOCKED' ? 'blocked' : 'completed'))}">
                            <i th:class="${post.status.toString() == 'AVAILABLE' ? 'bi bi-check-circle' : 
                                         (post.status.toString() == 'RESERVED' ? 'bi bi-clock' : 
                                         (post.status.toString() == 'BLOCKED' ? 'bi bi-exclamation-triangle' : 'bi bi-check-square'))}"></i>
                            <span th:text="${post.status.toString() == 'AVAILABLE' ? '판매중' : 
                                           (post.status.toString() == 'RESERVED' ? '예약중' : 
                                           (post.status.toString() == 'BLOCKED' ? '차단됨' : '거래완료'))}"></span>
                        </span>
                        
                        <!-- 작성자용 블락/신고 안내 -->
                        <div th:if="${isOwner && post.status.toString() == 'BLOCKED'}" class="alert alert-warning mt-3" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <strong>게시글이 임시 차단되었습니다.</strong><br>
                            다수의 신고로 인해 게시글이 자동으로 차단되었습니다. 관리자 검토 후 처리됩니다.
                        </div>
                        
                        <div th:if="${isOwner && !canChangeStatus && post.status.toString() != 'BLOCKED'}" class="alert alert-info mt-3" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <strong>상태 변경이 제한되었습니다.</strong><br>
                            신고가 다수 접수되어 상태 변경이 제한되었습니다. 관리자에게 문의해주세요.
                        </div>
                    </div>
                    
                    <!-- 제목 및 더보기 메뉴 -->
                    <div class="d-flex align-items-start justify-content-between mb-3">
                        <h1 class="post-title mb-0" th:text="${post.title}">게시글 제목</h1>
                        
                        <!-- 더보기 메뉴 (비작성자만) -->
                        <div th:if="${!isOwner}" sec:authorize="isAuthenticated()" class="dropdown">
                            <button class="btn btn-sm btn-light rounded-circle" type="button" 
                                    data-bs-toggle="dropdown" aria-expanded="false"
                                    style="width: 36px; height: 36px;">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item text-danger" href="#" 
                                       onclick="showReportModal('POST', postId); return false;">
                                    <i class="bi bi-exclamation-triangle me-2"></i>신고하기
                                </a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- 메타 정보 -->
                    <div class="post-meta">
                        <div class="post-meta-item">
                            <i class="bi bi-person"></i>
                            <span th:text="${post.user.name}">작성자</span>
                        </div>
                        <div class="post-meta-item">
                            <i class="bi bi-calendar"></i>
                            <span th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">2024.01.01</span>
                        </div>
                        <div class="post-meta-item">
                            <i class="bi bi-eye"></i>
                            <span th:text="${post.viewCount}">0</span>
                        </div>
                        <div class="post-meta-item">
                            <i class="bi bi-heart"></i>
                            <span th:text="${post.wishlistCount}">0</span>
                        </div>
                    </div>
                    
                    <!-- 가격 -->
                    <div class="price-display" th:text="${#numbers.formatInteger(post.price, 0, 'COMMA') + '원'}">0원</div>
                    
                    <!-- 액션 버튼 -->
                    <div class="action-buttons">
                        <!-- 작성자 버튼 -->
                        <div th:if="${isOwner}" class="d-flex gap-2 w-100">
                            <a th:href="@{/posts/{id}/edit(id=${post.postId})}" class="btn-edit text-center text-decoration-none">
                                <i class="bi bi-pencil"></i> 수정
                            </a>
                            <button type="submit" class="btn-delete" 
                                    onclick="if(confirm('정말로 삭제하시겠습니까?')) { 
                                        const form = document.createElement('form'); 
                                        form.method = 'post'; 
                                        form.action = '/posts/' + /*[[${post.postId}]]*/ + '/delete'; 
                                        const csrf = document.createElement('input'); 
                                        csrf.type = 'hidden'; 
                                        csrf.name = '_csrf'; 
                                        csrf.value = /*[[${_csrf.token}]]*/; 
                                        form.appendChild(csrf); 
                                        document.body.appendChild(form); 
                                        form.submit(); 
                                    }">
                                <i class="bi bi-trash"></i> 삭제
                            </button>
                            
                            <!-- 상태 변경 드롭다운 -->
                            <div class="dropdown" style="flex: 1;" th:if="${canChangeStatus}">
                                <button class="btn-status dropdown-toggle w-100" type="button" 
                                        data-bs-toggle="dropdown" aria-expanded="false" id="statusDropdown">
                                    <i class="bi bi-gear"></i> 상태 변경
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="statusDropdown">
                                    <li><a class="dropdown-item" href="#" 
                                           th:classappend="${post.status.toString() == 'AVAILABLE' ? 'active' : ''}"
                                           onclick="updateStatus('AVAILABLE'); return false;">
                                        <i class="bi bi-check-circle text-success"></i> 판매중
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" 
                                           th:classappend="${post.status.toString() == 'RESERVED' ? 'active' : ''}"
                                           onclick="updateStatus('RESERVED'); return false;">
                                        <i class="bi bi-clock text-warning"></i> 예약중
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" 
                                           th:classappend="${post.status.toString() == 'COMPLETED' ? 'active' : ''}"
                                           onclick="updateStatus('COMPLETED'); return false;">
                                        <i class="bi bi-check-square text-secondary"></i> 거래완료
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- 비작성자 버튼 (로그인 사용자) -->
                        <div th:if="${!isOwner}" sec:authorize="isAuthenticated()" class="w-100">
                            <button class="btn-chat" 
                                    id="startChatBtn"
                                    th:data-post-id="${post.postId}"
                                    th:disabled="${post.status.toString() == 'COMPLETED'}">
                                <i class="bi bi-chat-dots"></i> 
                                <span th:text="${post.status.toString() == 'COMPLETED' ? '거래완료된 상품입니다' : 
                                               (post.status.toString() == 'BLOCKED' ? '신고로 인해 차단된 상품입니다' : '채팅으로 문의하기')}"></span>
                            </button>
                            <button class="btn-wishlist" id="wishlistBtn" 
                                    th:data-post-id="${post.postId}">
                                <i class="bi bi-heart" id="wishlistIcon"></i> 
                                <span id="wishlistText">찜하기</span>
                            </button>
                        </div>
                        
                        <!-- 비로그인 사용자 -->
                        <div th:if="${!isOwner}" sec:authorize="!isAuthenticated()" class="w-100">
                            <a href="/login" class="btn-chat w-100 text-center">
                                <i class="bi bi-box-arrow-in-right"></i> 로그인하여 문의하기
                            </a>
                        </div>
                    </div>
                    
                    
                    <!-- 거래 정보 -->
                    <div class="info-card">
                        <h6><i class="bi bi-truck"></i> 거래 정보</h6>
                        <div class="mb-2">
                            <small class="text-muted d-block">거래 방법</small>
                            <div class="transaction-tags">
                                <span th:if="${post.transactionMethod.toString() == 'DIRECT'}" class="transaction-tag">
                                    <i class="bi bi-person-check"></i>직거래
                                </span>
                                <span th:if="${post.transactionMethod.toString() == 'PARCEL'}" class="transaction-tag">
                                    <i class="bi bi-box-seam"></i>택배거래
                                </span>
                                <span th:if="${post.transactionMethod.toString() == 'BOTH'}" class="transaction-tag">
                                    <i class="bi bi-person-check"></i>직거래
                                </span>
                                <span th:if="${post.transactionMethod.toString() == 'BOTH'}" class="transaction-tag">
                                    <i class="bi bi-box-seam"></i>택배거래
                                </span>
                            </div>
                        </div>
                        <div th:if="${post.campusLocation != null and !post.campusLocation.isEmpty() and post.transactionMethod.toString() != 'PARCEL'}">
                            <small class="text-muted d-block">거래 희망 장소</small>
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-geo-alt-fill text-danger"></i>
                                <span th:text="${post.campusLocation}"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 책 정보 -->
                    <div th:if="${post.book != null}" class="info-card">
                        <h6><i class="bi bi-book"></i> 교재 정보</h6>
                        <div class="d-flex gap-3">
                            <!-- 책 표지 이미지 -->
                            <div style="width: 80px; height: 100px; flex-shrink: 0;">
                                <img th:if="${post.book.imageUrl != null and !post.book.imageUrl.isEmpty()}" 
                                     th:src="${post.book.imageUrl}" 
                                     alt="Book cover" 
                                     class="w-100 h-100 rounded"
                                     style="object-fit: cover;">
                                <div th:unless="${post.book.imageUrl != null and !post.book.imageUrl.isEmpty()}"
                                     class="w-100 h-100 bg-light rounded d-flex align-items-center justify-content-center">
                                    <i class="bi bi-book text-muted" style="font-size: 2rem;"></i>
                                </div>
                            </div>
                            
                            <!-- 책 정보 텍스트 -->
                            <div class="flex-grow-1">
                                <div th:if="${post.book.title}" class="mb-1">
                                    <small class="text-muted d-block">제목</small>
                                    <span class="fw-medium" th:text="${post.book.title}"></span>
                                </div>
                                <div th:if="${post.book.author}" class="mb-1">
                                    <small class="text-muted d-block">저자</small>
                                    <span class="fw-medium" th:text="${post.book.author}"></span>
                                </div>
                                <div th:if="${post.book.publisher}">
                                    <small class="text-muted d-block">출판사</small>
                                    <span class="fw-medium" th:text="${post.book.publisher}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 과목 정보 -->
                    <div th:if="${post.subject}" class="info-card">
                        <h6><i class="bi bi-mortarboard"></i> 과목 정보</h6>
                        <div class="row g-2">
                            <div class="col-12">
                                <small class="text-muted d-block">과목명</small>
                                <span class="fw-medium" th:text="${post.subject.subjectName}"></span>
                                <span class="subject-type-badge">
                                    <span th:text="${post.subject.type.toString() == 'MAJOR' ? '전공' : '교양'}"></span>
                                </span>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">교수</small>
                                <span class="fw-medium" th:text="${post.subject.professor.professorName}"></span>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">학교</small>
                                <span class="fw-medium" th:text="${post.subject.professor.department.school.schoolName}"></span>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">학과</small>
                                <span class="fw-medium" th:text="${post.subject.professor.department.departmentName}"></span>
                            </div>
                            <div class="col-6" th:if="${post.takenYear != null and post.takenSemester != null}">
                                <small class="text-muted d-block">수강 시기</small>
                                <span class="fw-medium">
                                    <span th:text="${post.takenYear}"></span>년 
                                    <span th:text="${post.takenSemester.toString() == 'SPRING' ? '1학기' : 
                                                    post.takenSemester.toString() == 'FALL' ? '2학기' : 
                                                    post.takenSemester.toString() == 'SUMMER' ? '여름학기' : 
                                                    '겨울학기'}"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 판매자 정보 -->
                    <div class="seller-card">
                        <div class="position-relative">
                            <div class="seller-avatar" th:text="${#strings.substring(post.user.name, 0, 1)}">이</div>
                            <h6 class="mb-2">판매자 정보</h6>
                            <p class="mb-1 fw-medium" th:text="${post.user.name}">이름</p>
                            <p class="mb-0 opacity-75">
                                <i class="bi bi-building"></i>
                                <span th:text="${post.user.school?.schoolName ?: '학교 정보 없음'}">학교명</span>
                                <i th:if="${post.user.verified}" class="bi bi-patch-check-fill ms-2" 
                                   style="color: rgba(255, 255, 255, 0.9); filter: brightness(1.2);" title="이메일 인증 완료"></i>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 모바일용 설명 섹션 -->
        <div th:if="${post.description}" class="description-section d-lg-none">
            <h5><i class="bi bi-card-text"></i> 상세 설명</h5>
            <div class="description-content" th:text="${post.description}">설명</div>
        </div>
    </div>
</div>

<!-- 관련 게시글 섹션 -->
<!-- 같은 책의 다른 게시글 -->
<section th:if="${relatedPosts != null and !relatedPosts.isEmpty()}" class="related-section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-book"></i> 같은 책의 다른 게시글
            </h2>
            <div class="swiper-navigation">
                <button class="swiper-btn book-prev">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="swiper-btn book-next">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <div class="swiper book-swiper">
            <div class="swiper-wrapper">
                <div th:each="relatedPost : ${relatedPosts}" class="swiper-slide">
                    <a th:href="@{/posts/{id}(id=${relatedPost.postId})}" class="text-decoration-none">
                        <div class="related-card">
                            <!-- 상태 배지 -->
                            <div class="position-absolute top-0 end-0 m-3" style="z-index: 10;">
                                <span class="badge status-badge"
                                      th:classappend="${relatedPost.status.toString() == 'AVAILABLE' ? 'available' : 
                                                      (relatedPost.status.toString() == 'RESERVED' ? 'reserved' : 
                                                      (relatedPost.status.toString() == 'BLOCKED' ? 'blocked' : 'completed'))}">
                                    <i th:class="${relatedPost.status.toString() == 'AVAILABLE' ? 'bi bi-check-circle' : 
                                                 (relatedPost.status.toString() == 'RESERVED' ? 'bi bi-clock' : 
                                                 (relatedPost.status.toString() == 'BLOCKED' ? 'bi bi-exclamation-triangle' : 'bi bi-check-square'))}"></i>
                                    <span th:text="${relatedPost.status.toString() == 'AVAILABLE' ? '판매중' : 
                                                   (relatedPost.status.toString() == 'RESERVED' ? '예약중' : 
                                                   (relatedPost.status.toString() == 'BLOCKED' ? '차단됨' : '거래완료'))}"></span>
                                </span>
                            </div>
                            
                            <!-- 이미지 -->
                            <div class="related-card-image">
                                <img th:if="${relatedPost.postImages != null and !relatedPost.postImages.isEmpty()}" 
                                     th:src="${relatedPost.postImages[0].imageUrl}" 
                                     th:alt="${relatedPost.title}">
                                <div th:unless="${relatedPost.postImages != null and !relatedPost.postImages.isEmpty()}" 
                                     class="h-100 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                </div>
                            </div>
                            
                            <!-- 카드 내용 -->
                            <div class="related-card-body">
                                <h6 class="related-card-title text-dark" th:text="${relatedPost.title}">제목</h6>
                                <p class="related-card-price mb-2" 
                                   th:text="${#numbers.formatInteger(relatedPost.price, 0, 'COMMA') + '원'}">0원</p>
                                
                                <!-- 메타 정보 -->
                                <div class="meta-info">
                                    <!-- 과목/교수 정보 -->
                                    <div th:if="${relatedPost.subject != null}" class="mb-1">
                                        <i class="bi bi-book-fill"></i>
                                        <span class="post-subject-name" th:text="${relatedPost.subject.subjectName}">과목명</span>
                                        <span th:if="${relatedPost.subject.professor != null}">
                                            · <span class="post-professor-name" th:text="${relatedPost.subject.professor.professorName}">교수명</span>
                                        </span>
                                    </div>
                                    
                                    <!-- 책 정보 -->
                                    <div th:if="${relatedPost.book != null}" class="mb-1">
                                        <i class="bi bi-journal-bookmark-fill"></i>
                                        <span class="post-book-title" th:text="${relatedPost.book.title}">책 제목</span>
                                    </div>
                                    
                                    <!-- 작성자 정보 -->
                                    <div class="mb-1">
                                        <i class="bi bi-person-fill"></i>
                                        <span th:text="${relatedPost.user.name}">작성자</span>
                                    </div>
                                </div>
                                
                                <!-- 하단 정보 -->
                                <div class="card-footer-info">
                                    <small class="text-muted">
                                        <i class="bi bi-eye-fill"></i> <span th:text="${relatedPost.viewCount}">0</span>
                                        
                                        <!-- 찜하기 하트 아이콘 -->
                                        <span class="ms-2">
                                            <i class="bi bi-heart"></i>
                                            <span th:text="${relatedPost.wishlistCount}" class="wishlist-count">0</span>
                                        </span>
                                    </small>
                                    <small class="text-muted" 
                                           th:text="${#temporals.format(relatedPost.createdAt, 'MM.dd HH:mm')}">01.01</small>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 같은 과목의 다른 게시글 -->
<section th:if="${subjectRelatedPosts != null and !subjectRelatedPosts.isEmpty()}" class="related-section bg-white">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-mortarboard"></i> 같은 과목의 다른 자료
            </h2>
            <div class="swiper-navigation">
                <button class="swiper-btn subject-prev">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="swiper-btn subject-next">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <div class="swiper subject-swiper">
            <div class="swiper-wrapper">
                <div th:each="relatedPost : ${subjectRelatedPosts}" class="swiper-slide">
                    <a th:href="@{/posts/{id}(id=${relatedPost.postId})}" class="text-decoration-none">
                        <div class="related-card">
                            <!-- 상태 배지 -->
                            <div class="position-absolute top-0 end-0 m-3" style="z-index: 10;">
                                <span class="badge status-badge"
                                      th:classappend="${relatedPost.status.toString() == 'AVAILABLE' ? 'available' : 
                                                      (relatedPost.status.toString() == 'RESERVED' ? 'reserved' : 
                                                      (relatedPost.status.toString() == 'BLOCKED' ? 'blocked' : 'completed'))}">
                                    <i th:class="${relatedPost.status.toString() == 'AVAILABLE' ? 'bi bi-check-circle' : 
                                                 (relatedPost.status.toString() == 'RESERVED' ? 'bi bi-clock' : 
                                                 (relatedPost.status.toString() == 'BLOCKED' ? 'bi bi-exclamation-triangle' : 'bi bi-check-square'))}"></i>
                                    <span th:text="${relatedPost.status.toString() == 'AVAILABLE' ? '판매중' : 
                                                   (relatedPost.status.toString() == 'RESERVED' ? '예약중' : 
                                                   (relatedPost.status.toString() == 'BLOCKED' ? '차단됨' : '거래완료'))}"></span>
                                </span>
                            </div>
                            
                            <!-- 이미지 -->
                            <div class="related-card-image">
                                <img th:if="${relatedPost.postImages != null and !relatedPost.postImages.isEmpty()}" 
                                     th:src="${relatedPost.postImages[0].imageUrl}" 
                                     th:alt="${relatedPost.title}">
                                <div th:unless="${relatedPost.postImages != null and !relatedPost.postImages.isEmpty()}" 
                                     class="h-100 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                </div>
                            </div>
                            
                            <!-- 카드 내용 -->
                            <div class="related-card-body">
                                <h6 class="related-card-title text-dark" th:text="${relatedPost.title}">제목</h6>
                                <p class="related-card-price mb-2" 
                                   th:text="${#numbers.formatInteger(relatedPost.price, 0, 'COMMA') + '원'}">0원</p>
                                
                                <!-- 메타 정보 -->
                                <div class="meta-info">
                                    <!-- 과목/교수 정보 -->
                                    <div th:if="${relatedPost.subject != null}" class="mb-1">
                                        <i class="bi bi-book-fill"></i>
                                        <span class="post-subject-name" th:text="${relatedPost.subject.subjectName}">과목명</span>
                                        <span th:if="${relatedPost.subject.professor != null}">
                                            · <span class="post-professor-name" th:text="${relatedPost.subject.professor.professorName}">교수명</span>
                                        </span>
                                    </div>
                                    
                                    <!-- 책 정보 -->
                                    <div th:if="${relatedPost.book != null}" class="mb-1">
                                        <i class="bi bi-journal-bookmark-fill"></i>
                                        <span class="post-book-title" th:text="${relatedPost.book.title}">책 제목</span>
                                    </div>
                                    
                                    <!-- 작성자 정보 -->
                                    <div class="mb-1">
                                        <i class="bi bi-person-fill"></i>
                                        <span th:text="${relatedPost.user.name}">작성자</span>
                                    </div>
                                </div>
                                
                                <!-- 하단 정보 -->
                                <div class="card-footer-info">
                                    <small class="text-muted">
                                        <i class="bi bi-eye-fill"></i> <span th:text="${relatedPost.viewCount}">0</span>
                                        
                                        <!-- 찜하기 하트 아이콘 -->
                                        <span class="ms-2">
                                            <i class="bi bi-heart"></i>
                                            <span th:text="${relatedPost.wishlistCount}" class="wishlist-count">0</span>
                                        </span>
                                    </small>
                                    <small class="text-muted" 
                                           th:text="${#temporals.format(relatedPost.createdAt, 'MM.dd HH:mm')}">01.01</small>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 공통 Footer 포함 -->
<footer th:replace="~{fragments/header :: footer}"></footer>

<!-- 신고 모달 -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportModalLabel">
                    <i class="bi bi-exclamation-triangle text-danger me-2"></i>신고하기
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="reportForm">
                    <input type="hidden" id="reportType" name="reportType">
                    <input type="hidden" id="targetId" name="targetId">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">신고 사유를 선택해주세요</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categorySpam" value="SPAM">
                            <label class="form-check-label" for="categorySpam">
                                스팸/도배
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categoryFraud" value="FRAUD">
                            <label class="form-check-label" for="categoryFraud">
                                사기/허위매물
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categoryInappropriate" value="INAPPROPRIATE_CONTENT">
                            <label class="form-check-label" for="categoryInappropriate">
                                부적절한 콘텐츠
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categoryAbusive" value="ABUSIVE_BEHAVIOR">
                            <label class="form-check-label" for="categoryAbusive">
                                욕설/비방
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categoryIllegal" value="ILLEGAL_ITEM">
                            <label class="form-check-label" for="categoryIllegal">
                                금지 물품
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="category" id="categoryOther" value="OTHER">
                            <label class="form-check-label" for="categoryOther">
                                기타
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="reportContent" class="form-label">상세 내용 (선택사항)</label>
                        <textarea class="form-control" id="reportContent" name="content" rows="3" 
                                  placeholder="구체적인 신고 내용을 입력해주세요."></textarea>
                    </div>
                    
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <div>
                            허위 신고 시 이용에 제한이 있을 수 있습니다.
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-danger" onclick="submitReport()">신고하기</button>
            </div>
        </div>
    </div>
</div>

<!-- 공통 스크립트 포함 -->
<div th:replace="~{fragments/header :: scripts}"></div>

<!-- GLightbox JS -->
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/
var postId = /*[[${post.postId}]]*/ 0;

// 페이지 로드 시 초기화
$(document).ready(function() {
    console.log('Debug - postId:', postId);
    // GLightbox 초기화
    const lightbox = GLightbox({
        selector: '.gallery-image',
        touchNavigation: true,
        loop: true,
        closeOnOutsideClick: true
    });
    
    // 썸네일 클릭 이벤트
    $('.thumbnail-item').on('click', function() {
        const slideIndex = $(this).data('bs-slide-to');
        const carousel = new bootstrap.Carousel(document.getElementById('imageCarousel'));
        carousel.to(slideIndex);
    });
    
    // 캐러셀 슬라이드 이벤트
    $('#imageCarousel').on('slide.bs.carousel', function (e) {
        $('.thumbnail-item').removeClass('active');
        $('.thumbnail-item').eq(e.to).addClass('active');
    });
    
    // Swiper 초기화 - 같은 책 캐러셀
    if (document.querySelector('.book-swiper')) {
        new Swiper('.book-swiper', {
            slidesPerView: 1,
            spaceBetween: 20,
            navigation: {
                nextEl: '.book-next',
                prevEl: '.book-prev',
            },
            breakpoints: {
                576: {
                    slidesPerView: 2,
                },
                768: {
                    slidesPerView: 3,
                },
                1024: {
                    slidesPerView: 4,
                }
            }
        });
    }
    
    // Swiper 초기화 - 같은 과목 캐러셀
    if (document.querySelector('.subject-swiper')) {
        new Swiper('.subject-swiper', {
            slidesPerView: 1,
            spaceBetween: 20,
            navigation: {
                nextEl: '.subject-next',
                prevEl: '.subject-prev',
            },
            breakpoints: {
                576: {
                    slidesPerView: 2,
                },
                768: {
                    slidesPerView: 3,
                },
                1024: {
                    slidesPerView: 4,
                }
            }
        });
    }
    
    // 찜하기 초기 상태 로드
    loadWishlistStatus();
    
    // 찜하기 버튼 클릭 이벤트
    $('#wishlistBtn').on('click', function() {
        toggleWishlist();
    });
    
    // 채팅 시작 버튼 클릭 이벤트
    $('#startChatBtn').on('click', function() {
        startChat();
    });
    
    // 애니메이션 효과
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in-up');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    
    document.querySelectorAll('.info-card, .description-section, .related-section').forEach(el => {
        observer.observe(el);
    });
});

// 상태 변경 함수
function updateStatus(newStatus) {
    if (confirm('상태를 변경하시겠습니까?')) {
        $.ajax({
            url: '/posts/' + postId + '/status',
            type: 'POST',
            data: { 
                status: newStatus,
                _csrf: /*[[${_csrf.token}]]*/ ''
            },
            success: function(response) {
                location.reload();
            },
            error: function(xhr) {
                alert('상태 변경에 실패했습니다.');
            }
        });
    }
}

// 찜하기 상태 로드
function loadWishlistStatus() {
    var postId = $('#wishlistBtn').data('post-id');
    if (!postId) return;
    
    $.ajax({
        url: '/api/wishlist/check/' + postId,
        type: 'GET',
        success: function(response) {
            if (response.success) {
                updateWishlistButton(response.isWishlisted);
            }
        },
        error: function(xhr) {
            console.log('찜 상태 확인 실패');
        }
    });
}

// 찜하기 토글
function toggleWishlist() {
    var postId = $('#wishlistBtn').data('post-id');
    if (!postId) return;
    
    $('#wishlistBtn').prop('disabled', true);
    
    $.ajax({
        url: '/api/wishlist/toggle/' + postId,
        type: 'POST',
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            var csrfHeader = $('meta[name="_csrf_header"]').attr('content');
            var csrfToken = $('meta[name="_csrf"]').attr('content');
            if (csrfHeader && csrfToken) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            }
        },
        success: function(response) {
            if (response.success) {
                updateWishlistButton(response.isWishlisted);
                updateWishlistCount(response.isWishlisted);
                showToast(response.message);
            } else {
                showToast(response.message || '찜하기 처리에 실패했습니다.');
            }
        },
        error: function(xhr) {
            if (xhr.status === 400) {
                var response = xhr.responseJSON;
                showToast(response.message || '찜하기 처리에 실패했습니다.');
            } else {
                showToast('찜하기 처리 중 오류가 발생했습니다.');
            }
        },
        complete: function() {
            $('#wishlistBtn').prop('disabled', false);
        }
    });
}

// 찜하기 버튼 UI 업데이트
function updateWishlistButton(isWishlisted) {
    var btn = $('#wishlistBtn');
    var icon = $('#wishlistIcon');
    var text = $('#wishlistText');
    
    if (isWishlisted) {
        btn.addClass('active');
        icon.removeClass('bi-heart').addClass('bi-heart-fill');
        text.text('찜 해제');
    } else {
        btn.removeClass('active');
        icon.removeClass('bi-heart-fill').addClass('bi-heart');
        text.text('찜하기');
    }
}

// 찜 개수 업데이트
function updateWishlistCount(isWishlisted) {
    var countElement = $('#wishlistCount');
    var currentCount = parseInt(countElement.text()) || 0;
    var newCount = isWishlisted ? currentCount + 1 : Math.max(0, currentCount - 1);
    countElement.text(newCount + '명');
}

// 채팅 시작
function startChat() {
    var postId = $('#startChatBtn').data('post-id');
    if (!postId) return;
    
    $('#startChatBtn').prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> 채팅방 생성 중...');
    
    $.ajax({
        url: '/api/chat/rooms',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            postId: postId,
            initialMessage: null
        }),
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            var csrfHeader = $('meta[name="_csrf_header"]').attr('content');
            var csrfToken = $('meta[name="_csrf"]').attr('content');
            if (csrfHeader && csrfToken) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            }
        },
        success: function(response) {
            if (response.success) {
                window.location.href = '/chat/rooms/' + response.data.chatRoomId;
            } else {
                showToast(response.message || '채팅방 생성에 실패했습니다.');
            }
        },
        error: function(xhr) {
            if (xhr.status === 400) {
                var response = xhr.responseJSON;
                showToast(response.message || '채팅방 생성에 실패했습니다.');
            } else {
                showToast('채팅방 생성 중 오류가 발생했습니다.');
            }
        },
        complete: function() {
            $('#startChatBtn').prop('disabled', false).html('<i class="bi bi-chat-dots"></i> 채팅으로 문의하기');
        }
    });
}

// 신고 모달 표시
function showReportModal(reportType, targetId) {
    console.log('Debug - showReportModal called with:', reportType, targetId);
    
    // 먼저 중복 신고 여부 확인
    $.ajax({
        url: '/api/reports/check',
        type: 'GET',
        data: {
            reportType: reportType,
            targetId: targetId
        },
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            var csrfHeader = $('meta[name="_csrf_header"]').attr('content');
            var csrfToken = $('meta[name="_csrf"]').attr('content');
            if (csrfHeader && csrfToken) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            }
        },
        success: function(response) {
            if (response.success) {
                var checkResult = response.data;
                if (checkResult.canReport) {
                    // 신고 가능한 경우 모달 표시
                    $('#reportType').val(reportType);
                    $('#targetId').val(targetId);
                    $('#reportForm')[0].reset();
                    
                    // 카테고리 라디오 버튼 초기화
                    $('input[name="category"]').prop('checked', false);
                    
                    $('#reportModal').modal('show');
                } else {
                    // 신고 불가능한 경우 메시지 표시
                    showToast(checkResult.message);
                }
            } else {
                // API 오류 시에도 모달 표시 (사용자 편의)
                console.warn('신고 가능 여부 확인 실패:', response.message);
                $('#reportType').val(reportType);
                $('#targetId').val(targetId);
                $('#reportForm')[0].reset();
                $('input[name="category"]').prop('checked', false);
                $('#reportModal').modal('show');
            }
        },
        error: function(xhr) {
            // 네트워크 오류 시에도 모달 표시 (사용자 편의)
            console.warn('신고 중복 확인 요청 실패');
            $('#reportType').val(reportType);
            $('#targetId').val(targetId);
            $('#reportForm')[0].reset();
            $('input[name="category"]').prop('checked', false);
            $('#reportModal').modal('show');
        }
    });
}

// 신고 제출
function submitReport() {
    var reportType = $('#reportType').val();
    var targetId = $('#targetId').val();
    var category = $('input[name="category"]:checked').val();
    var content = $('#reportContent').val();
    
    console.log('Debug - reportType:', reportType, 'targetId:', targetId, 'category:', category);
    
    if (!category) {
        showToast('신고 사유를 선택해주세요.');
        return;
    }
    
    if (!targetId || targetId === '') {
        showToast('신고 대상을 찾을 수 없습니다.');
        return;
    }
    
    var parsedTargetId = parseInt(targetId);
    if (isNaN(parsedTargetId)) {
        showToast('올바르지 않은 신고 대상입니다.');
        return;
    }
    
    var data = {
        reportType: reportType,
        targetId: parsedTargetId,
        category: category,
        content: content.trim() || null
    };
    
    console.log('Debug - Sending data:', data);
    
    $.ajax({
        url: '/api/reports',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            var csrfHeader = $('meta[name="_csrf_header"]').attr('content');
            var csrfToken = $('meta[name="_csrf"]').attr('content');
            if (csrfHeader && csrfToken) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
            }
        },
        success: function(response) {
            if (response.success) {
                $('#reportModal').modal('hide');
                showToast('신고가 접수되었습니다. 검토 후 처리하겠습니다.');
            } else {
                showToast(response.message || '신고 접수에 실패했습니다.');
            }
        },
        error: function(xhr) {
            if (xhr.status === 400) {
                var response = xhr.responseJSON;
                showToast(response.message || '신고 접수에 실패했습니다.');
            } else {
                showToast('신고 접수 중 오류가 발생했습니다.');
            }
        }
    });
}

// 토스트 메시지
function showToast(message) {
    $('.toast-container').remove();
    
    var isWarning = message.includes('자신의 게시글') || message.includes('이메일 인증');
    var backgroundColor = isWarning ? 'rgba(255, 193, 7, 0.9)' : 'rgba(25, 135, 84, 0.9)';
    var textColor = isWarning ? '#664d03' : '#ffffff';
    
    var toast = $('<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">' +
                  '<div class="toast border-0" role="alert" style="background-color: ' + backgroundColor + '; color: ' + textColor + ';">' +
                  '<div class="toast-body text-center fw-medium">' + message + '</div>' +
                  '</div></div>');
    
    $('body').append(toast);
    
    var bsToast = new bootstrap.Toast(toast.find('.toast')[0], {
        autohide: true,
        delay: isWarning ? 2500 : 2000
    });
    bsToast.show();
    
    setTimeout(function() {
        toast.remove();
    }, isWarning ? 3500 : 3000);
}
/*]]>*/
</script>
</body>
</html>