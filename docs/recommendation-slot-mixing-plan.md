## Slot-based Mixing 계획

### 배경 / 문제점
- 현재 추천은 AVAILABLE 전량을 실시간 스코어링해 개인화(콘텐츠/협업)로만 정렬.
  - 인기/신선/탐험 슬롯이 없어 최신 글·무이력 사용자에 대한 탐험이 부족.
  - 전량 스캔 구조로 규모가 커지면 응답 지연/부하 위험.
- 기본 콘텐츠 점수는 이력 없으면 0.5로 시작해 탐험 성격이 암묵적으로 섞임. 탐험을 슬롯으로 분리하면 기본값을 낮추거나 끌 수 있음.

### 목표
- 여러 소스(개인화, 인기, 신선, 탐험)를 정해진 비율로 섞는 slot-based mixing을 옵션으로 도입(기본 비활성).
- 슬롯 ON 시에도 후보 부족/중복에 안전한 폴백을 갖춘다.
- 응답에 `source` 라벨을 포함해 슬롯별 CTR/노출을 분석 가능하게 한다.

### 구현 계획
1) 프로퍼티 추가 (`recommendation.*`, 기본: 슬롯 OFF, 현행 유지)
   - `slot-mix.enabled` (기본 false)
   - 비율: `slot-mix.personalized-ratio`, `popular-ratio`, `fresh-ratio`, `explore-epsilon`
   - 후보 범위: `popular-lookback-days`, `fresh-window-days`
   - 크기: `slot-mix.size` (최대 추천 수), `explore-size`(탐험 선택 시 샘플 수)
2) 후보 풀 생성 (슬롯 ON일 때만)
   - 개인화 풀: 현행 점수 계산 결과 상위 K (전수 스캔/정렬을 피하기 위한 쿼리/샘플링/캐시 고려)
   - 인기 풀: 최근 N일 클릭/조회 상위 M (간단 쿼리 → 필요 시 캐시/배치 확장)
   - 신선 풀: 최근 X일 게시글 중 랜덤/간단 점수 상위 R
   - 탐험: ε 비율로 신선/랜덤 풀에서 추출
   - 후보 부족 시 개인화로 보충, 중복 제거
3) 믹싱 로직
   - 비율 합 검증 (합이 1이 아니면 정규화 or 안전한 디폴트)
   - 비율대로 각 풀에서 뽑되, 부족 시 다른 풀로 보충
   - 최종 리스트 크기는 `slot-mix.size` 이하
   - 각 아이템에 `source` 라벨(`personalized|popular|fresh|explore`) 부여
4) 트래킹
   - 클릭/노출 트래킹 DTO/API에 `source` 라벨 추가 → 슬롯별 CTR 집계 가능
5) 기본값/토글
   - `slot-mix.enabled=false`일 때는 현행 로직 그대로(회귀 방지)
   - 슬롯 ON일 때만 위 믹싱 경로 사용

### 기대 효과
- 신선/탐험 슬롯으로 신규 게시글 노출 기회 확보, 인기 편향 완화.
- 개인화와 별도로 인기/신선 신호를 섞어 CTR 개선 실험 가능.
- `source` 라벨 기반으로 슬롯별 성능 비교 용이.

### 리스크/사이드이펙트 및 대응
- 후보 부족/비율 불일치 → 비율 정규화, 개인화 보충, 중복 제거 로직 필수.
- 잘못된 설정으로 빈 리스트/중복 가능 → 기본값을 슬롯 OFF, 안전한 디폴트 비율 제공.
- 실시간 인기/신선 후보 쿼리 부하 → 간단 쿼리(최근 N일)로 시작, 필요 시 캐시/배치 고려.
- 전수 스캔 부하 → 개인화 풀도 상위 K 쿼리/샘플링/캐시로 제한하는 설계 필요(슬롯 ON 시 우선 검토).
- 무이력 사용자 기본값 0.5 → 슬롯 ON 시 더 낮게(또는 0) 설정하고 신선/탐험 슬롯에 노출을 맡기는 옵션 고려.
- `RecommendationWeights`의 popularity/recency 필드 현재 미사용 → 슬롯 도입 시 여전히 0으로 유지하거나 명시적으로 무시 주석 추가.
- 추천 품질 변동 → 토글로 단계적 적용, 스모크 테스트(추천 응답/트래킹) 수행.

### 참고 (현행 로직)
- 후보: AVAILABLE 전량 → 개인화 점수 계산.
- 점수: 콘텐츠(행동 가중치+감쇠+유사도 가중치+콘텐츠 최신성 보정) + 협업(조회 기반 정규화) 가중합.
- 이력 없음: 콘텐츠 점수 0.5 기본값(탐험 성격).
- 협업 후보: 1회 쿼리 후 맵 재사용.
