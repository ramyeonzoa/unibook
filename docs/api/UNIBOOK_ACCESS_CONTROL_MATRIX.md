# Unibook Access Control Matrix
* 모든 기능에 대한 사용자 권한을 정리한 Access Control Matrix
* 사용자 유형별, 게시글 상태별 세분화된 권한 체계
* Last updated: Jun. 11. 2025.
* Author: 컴퓨터시스템공학과(심화) 202546016 최민혁

## User Types Definition

| User Type | Description | Key Permissions |
|-----------|-------------|-----------------|
| **비로그인 (Guest)** | 인증되지 않은 방문자 | 읽기 전용, 제한적 접근 |
| **타인 (Other User)** | 로그인했지만 게시글 소유자가 아닌 사용자 | 일반적인 상호작용 가능 |
| **게시글 소유자 (Post Owner)** | 해당 게시글을 작성한 사용자 | 자신의 게시글 관리 권한 |
| **관리자 (Admin)** | ROLE_ADMIN 권한을 가진 사용자 | 모든 관리 기능 접근 가능 |

## Main Access Control Matrix

### 1. 게시글 조회 및 관리 권한

| 기능 | 게시글 소유자 | 관리자 | 타인 | 비로그인 |
|------|---------------|--------|------|----------|
| **일반 게시글 조회** | ✅ | ✅ | ✅ | ✅ |
| **BLOCKED 게시글 조회** | ✅ | ✅ | ❌ | ❌ |
| **일반 게시글 수정** | ✅ | ✅ | ❌ | ❌ |
| **BLOCKED 게시글 수정** | ❌ | ✅ | ❌ | ❌ |
| **게시글 삭제** | ✅ | ✅ | ❌ | ❌ |
| **게시글 상태 변경** | ✅* | ❌ | ❌ | ❌ |
| **게시글 차단/해제** | ❌ | ✅ | ❌ | ❌ |
| **가격 시세 조회** | ✅ | ✅ | ✅ | ✅ |
| **게시글 이미지 보기** | ✅ | ✅ | ✅ | ✅ |
| **판매자 정보 보기** | - | ✅ | ✅ | ❌ |

*\* BLOCKED 상태이거나 신고 3회 이상인 경우 불가*

### 2. 게시글 생성 및 상호작용 권한

| 기능 | 게시글 소유자 | 관리자 | 타인 | 비로그인 |
|------|---------------|--------|------|----------|
| **게시글 작성** | - | ✅ | ✅ | ❌ |
| **찜하기** | ❌** | ✅ | ✅*** | ❌ |
| **찜 해제** | ❌ | ✅ | ✅ | ❌ |
| **채팅하기** | ❌ | ✅ | ✅**** | ❌ |
| **신고하기** | ❌ | ❌ | ✅ | ❌ |
| **댓글 작성** | ✅ | ✅ | ✅ | ❌ |

*\*\* 자신의 게시글은 찜 불가*  
*\*\*\* 이메일 인증 필요*  
*\*\*\*\* AVAILABLE/RESERVED 상태만 가능*

## Status-based Permission Matrix

### 게시글 상태별 기능 제한

| 기능 | AVAILABLE | RESERVED | COMPLETED | BLOCKED |
|------|-----------|----------|-----------|---------|
| **찜하기 가능** | ✅ | ✅ | ❌ | ❌ |
| **채팅하기 가능** | ✅ | ✅* | ❌ | ❌ |
| **연락하기 버튼 표시** | ✅ | ✅ | ❌ | ❌ |
| **검색 결과 노출** | ✅ | ✅ | ✅ | ❌ |
| **목록 페이지 표시** | ✅ | ✅ | ✅ | ❌** |
| **관련 게시글 추천** | ✅ | ❌ | ❌ | ❌ |
| **가격 시세 포함** | ✅ | ✅ | ✅ | ❌ |
| **상태 변경 가능** | ✅ | ✅ | ✅ | ❌*** |

*\* 기존 채팅방 참여자만 가능*  
*\*\* 소유자와 관리자는 볼 수 있음*  
*\*\*\* 관리자만 차단 해제 가능*

## Notification Permission Matrix

### 알림 수신 권한

| 알림 유형 | 게시글 소유자 | 찜한 사용자 | 채팅 상대방 | 키워드 구독자 |
|-----------|---------------|-------------|-------------|---------------|
| **찜 알림** | ✅ | - | - | - |
| **찜 해제 알림** | ✅ | - | - | - |
| **상태 변경 알림** | - | ✅ | ✅ | - |
| **가격 변경 알림** | - | ✅ | - | - |
| **새 메시지 알림** | ✅ | - | ✅ | - |
| **키워드 매칭 알림** | - | - | - | ✅ |
| **차단 알림** | ✅ | ✅ | - | - |
| **신고 접수 알림** | ✅ | - | - | - |

## Chat System Permissions

### 채팅 기능별 권한

| 기능 | 판매자 | 구매자 | 관리자 | 기타 사용자 |
|------|--------|--------|--------|-------------|
| **채팅방 생성** | ❌ | ✅ | ✅ | ❌ |
| **메시지 전송** | ✅ | ✅ | ✅ | ❌ |
| **채팅방 나가기** | ✅ | ✅ | ✅ | ❌ |
| **채팅방 삭제** | ❌ | ❌ | ✅ | ❌ |
| **거래 상태 변경** | ✅ | ❌ | ✅ | ❌ |
| **채팅방 목록 조회** | ✅ | ✅ | ✅ | ❌ |
| **상대방 차단** | ✅ | ✅ | ✅ | ❌ |

## Admin-Specific Permissions

### 관리자 전용 기능

| 기능 | 일반 관리자 | 슈퍼 관리자 | 설명 |
|------|-------------|-------------|------|
| **사용자 정지** | ✅ | ✅ | 특정 기간 동안 로그인 차단 |
| **사용자 정지 해제** | ✅ | ✅ | 정지 상태 즉시 해제 |
| **게시글 차단** | ✅ | ✅ | 부적절한 게시글 숨김 |
| **게시글 차단 해제** | ✅ | ✅ | 차단된 게시글 복원 |
| **신고 처리** | ✅ | ✅ | 신고 검토 및 조치 |
| **대시보드 접근** | ✅ | ✅ | 통계 및 관리 도구 |
| **캐시 통계 조회** | ✅ | ✅ | 시스템 성능 모니터링 |
| **사용자별 게시글 조회** | ✅ | ✅ | 특정 사용자의 모든 활동 |
| **시스템 설정 변경** | ❌ | ✅ | 전역 설정 관리 |

## Search and Filter Permissions

### 검색 및 필터 권한

| 기능 | 로그인 사용자 | 비로그인 사용자 | 설명 |
|------|---------------|-----------------|------|
| **키워드 검색** | ✅ | ✅ | 제목, 설명 검색 |
| **학교 필터** | ✅ | ✅ | 특정 학교 게시글만 |
| **학과 필터** | ✅ | ✅ | 특정 학과 게시글만 |
| **과목 필터** | ✅ | ✅ | 특정 과목 관련 |
| **가격 필터** | ✅ | ✅ | 가격대별 필터링 |
| **상태 필터** | ✅ | ✅ | 거래 상태별 필터링 |
| **내 학교 우선 검색** | ✅ | ❌ | 소속 학교 우선 표시 |
| **찜한 게시글 보기** | ✅ | ❌ | 개인 찜 목록 |

## Email and Verification Permissions

### 이메일 및 인증 관련 권한

| 기능 | 인증된 사용자 | 미인증 사용자 | 비로그인 | 제한사항 |
|------|---------------|---------------|----------|----------|
| **게시글 작성** | ✅ | ✅ | ❌ | - |
| **찜하기** | ✅ | ❌ | ❌ | 이메일 인증 필수 |
| **키워드 알림 설정** | ✅ | ❌ | ❌ | 이메일 인증 필수 |
| **채팅하기** | ✅ | ✅ | ❌ | - |
| **프로필 수정** | ✅ | ✅ | ❌ | - |
| **이메일 재인증 요청** | ❌ | ✅ | ❌ | 60초 쿨다운 |

## Report System Permissions

### 신고 시스템 권한

| 기능 | 신고자 | 피신고자 | 관리자 | 기타 사용자 |
|------|--------|----------|--------|-------------|
| **신고하기** | ✅ | ❌* | ❌ | ✅ |
| **신고 내역 조회** | ✅ | ❌ | ✅ | ❌ |
| **신고 취소** | ❌ | ❌ | ✅ | ❌ |
| **신고 처리** | ❌ | ❌ | ✅ | ❌ |
| **이의 제기** | ❌ | ✅ | ✅ | ❌ |

*\* 자신의 게시글/자신을 신고할 수 없음*

## Rules

1. **3회 신고 시 자동 차단**
   - 서로 다른 3명의 사용자가 신고 시 자동으로 BLOCKED 상태 전환
   - 게시글 소유자도 상태 변경 불가능하게 됨

2. **정지된 사용자 제한**
   - 로그인 자체가 차단됨

3. **Rate Limiting 적용**
   - 이메일 재발송: 60초 쿨다운, 시간당 5회 제한

4. **채팅방 특수 권한**
   - 판매자는 자기 게시글에 대한 채팅방 생성 불가
   - 구매자만 채팅방 생성 가능
   - 거래 완료 후에도 채팅 이력 유지

## 📈 Permission Evolution

### 권한 시스템 진화 과정

1. **Phase 1 (초기)**: 기본적인 CRUD 권한만 구현
2. **Phase 2 (중기)**: 이메일 인증, 찜하기 권한 추가
3. **Phase 3 (Day 17)**: AuthorizationService 도입으로 중앙집중식 권한 관리
4. **Phase 4 (현재)**: 세분화된 상태별, 기능별 권한 체계 완성

## 🛠️ Implementation Details

### 주요 구현 클래스 및 메서드

```java
// AuthorizationService.java
- canView(Post post, UserPrincipal user)
- canEdit(Post post, UserPrincipal user)  
- canDelete(Post post, UserPrincipal user)
- requireOwnerOrAdmin(Post post, UserPrincipal user)
- isBlocked(Post post)

// SecurityConfig.java
- 로그인/비로그인 사용자 접근 제어
- API 엔드포인트별 권한 설정
- CSRF 보호 설정

// GlobalExceptionHandler.java
- AccessDeniedException 처리
- 권한 없음 에러 페이지/응답
```

## 📊 Summary Statistics

- **총 권한 체크 포인트**: 50+ 개
- **사용자 타입**: 4종 (Guest, User, Owner, Admin)
- **게시글 상태**: 4종 (AVAILABLE, RESERVED, COMPLETED, BLOCKED)
- **특수 규칙**: 5개
- **구현 복잡도**: 중상 (다층 권한 체계)

---

이 Access Control Matrix는 Unibook 플랫폼의 모든 권한 관련 비즈니스 로직을 완전히 문서화하여, 개발자와 관리자가 시스템의 보안 체계를 명확히 이해할 수 있도록 합니다.